<!DOCTYPE html>
     <html lang="en">
     <head>
       <meta charset="UTF-8">
       <meta name="viewport" content="width=device-width, initial-scale=1.0">
       <title>voxa</title>
       <style>
         body {
           font-family: Arial, sans-serif;
           background-color: #f0f2f5;
           margin: 0;
           padding: 20px;
           display: flex;
           justify-content: center;
         }
         .container {
           max-width: 600px;
           width: 100%;
           background: white;
           border-radius: 6px;
           box-shadow: 0 2px 4px rgba(0,0,0,0.1);
           padding: 20px;
         }
         h1 {
           font-size: 24px;
           color: #333;
           margin: 0 0 20px;
           text-align: center;
         }
         .input-group {
           margin-bottom: 15px;
         }
         input {
           width: 100%;
           padding: 10px;
           border: 1px solid #ddd;
           border-radius: 6px;
           font-size: 16px;
           box-sizing: border-box;
         }
         button {
           width: 100%;
           padding: 12px;
           background: #5e548e;
           color: white;
           border: none;
           border-radius: 6px;
           font-size: 16px;
           cursor: pointer;
           margin-top: 10px;
         }
         button:hover {
           background: #483d8b;
         }
         .message {
           padding: 10px;
           margin: 5px 0;
           border-radius: 6px;
         }
         .message.self {
           background: #e1f5fe;
           margin-left: 20%;
         }
         .message.other {
           background: #f5f5f5;
           margin-right: 20%;
         }
         .error {
           color: red;
           text-align: center;
           margin: 10px 0;
         }
         .share-link {
           margin-top: 10px;
           text-align: center;
         }
         .share-link a {
           color: #5e548e;
           text-decoration: none;
         }
         @media (max-width: 600px) {
           button {
             font-size: 36px;
             padding: 15px;
           }
         }
       </style>
     </head>
     <body>
       <div class="container">
         <h1 id="room-title">voxa</h1>
         <div id="join-room">
           <div class="input-group">
             <input id="room-id" type="text" placeholder="Room ID (optional)">
           </div>
           <div class="input-group">
             <input id="key" type="text" placeholder="Enter key">
           </div>
           <button onclick="Chat.joinRoom()">進入聊天</button>
         </div>
         <div id="chat" style="display: none;">
           <div id="messages"></div>
           <div class="input-group">
             <input id="message-input" type="text" placeholder="Type a message">
           </div>
           <button onclick="Chat.sendMessage()">傳送</button>
           <div class="share-link">
             <a id="share-link" href="#">分享連結</a>
           </div>
         </div>
         <div id="error" class="error"></div>
       </div>

       <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
       <script>
         const Chat = {
           CONFIG: {
             CONNECT_TIMEOUT: 10000
           },
           state: {
             socket: null,
             roomId: null,
             key: null
           },

           initSocket() {
             Chat.state.socket = io('https://voxa-chat.onrender.com', {
               timeout: Chat.CONFIG.CONNECT_TIMEOUT
             });

             Chat.state.socket.on('connect_error', () => {
               Chat.showError('無法連線到伺服器');
             });

             Chat.state.socket.on('room-update', ({ roomId, title }) => {
               document.getElementById('room-title').textContent = title;
               Chat.state.roomId = roomId;
               Chat.updateShareLink();
             });

             Chat.state.socket.on('receive-message', ({ message, sender }) => {
               Chat.addMessage(message, sender === Chat.state.socket.id);
             });
           },

           joinRoom() {
             const roomId = document.getElementById('room-id').value || Math.random().toString(36).slice(2);
             const key = document.getElementById('key').value;
             if (!key) {
               return Chat.showError('請輸入密鑰');
             }

             Chat.state.key = key;
             Chat.state.socket.emit('join-room', { roomId, key }, (response) => {
               if (response.error) {
                 Chat.showError('加入房間失敗：' + response.error);
               } else {
                 document.getElementById('join-room').style.display = 'none';
                 document.getElementById('chat').style.display = 'block';
                 Chat.updateShareLink();
               }
             });
           },

           sendMessage() {
             const input = document.getElementById('message-input');
             const message = input.value.trim();
             if (!message) return;

             Chat.state.socket.emit('send-message', { message }, (response) => {
               if (response.error) {
                 Chat.showError(response.error);
               } else {
                 input.value = '';
               }
             });
           },

           addMessage(message, isSelf) {
             const messages = document.getElementById('messages');
             const div = document.createElement('div');
             div.className = `message ${isSelf ? 'self' : 'other'}`;
             div.textContent = message;
             messages.appendChild(div);
             messages.scrollTop = messages.scrollHeight;
           },

           showError(message) {
             const errorDiv = document.getElementById('error');
             errorDiv.textContent = message;
             setTimeout(() => errorDiv.textContent = '', 3000);
           },

           updateShareLink() {
             const link = document.getElementById('share-link');
             const url = new URL(window.location.href);
             url.searchParams.set('room', Chat.state.roomId);
             link.href = url.toString();
             link.textContent = '分享連結';
           }
         };

         document.getElementById('message-input').addEventListener('keypress', (e) => {
           if (e.key === 'Enter') Chat.sendMessage();
         });

         Chat.initSocket();
       </script>
     </body>
     </html>
